{% extends 'accounts/base.html' %}
{% load static %}
{% load humanize %}
{% block app %}
<section id="genre">
    <section class="hero is-black">
        <div class="hero-body">
            <div class="container">
                <div class="tags">
                    <span class="tag is-white" v-for="genre in genreList"
                        :class="{ 'is-info': genre.name === selectedGenre }">
                        <!-- <a @click="getMovieList(genre)"> -->
                            <a :href=`/movies/genres/?name=${genre.name}`>
                                [[ genre.name ]]
                              </a>
                              <!-- <a :href="getGenreUrl([[genre.name]])">
                                </a> -->
                    </span>
                </div>
                <h1 class="title is-2" v-text="selectedGenre" style="font-family: 'Gugi'"></h1>
            </div>
        </div>
    </section>
    <section>
        
        <div class="container">
            <div class="columns is-multiline is-variable is-5" style="padding-left: 1rem; padding-right: 1rem;">
                <div class="column is-one-third" style="margin-bottom: 2rem;">
                    {% for movie in movies %}
                    <a href="{% url 'movies:detail' movie.pk}">
                        <div class="card genre-card" style="border-radius: 10px;"></div>
                            <div class="card-content">
                                <div class="media">
                                    <div class="media-content">
                                        <img style="max-width: 200; border-radius: 10px 10px 0 0;" src="https://image.tmdb.org/t/p/w500/{{ movie.poster_path }}" alt="{{ movie.title }}">
                                        <small>{{ movie.release_date }} 개봉</small>
                                        <br />
                                        <small>{{ movie.vote_average }}</small> &bull;
                                        <small><i class="fas fa-users"></i> {{ movie.popularity.toLocaleString()
                                            }}명</small>
                                    </div>
                                </div>
                                <div class="content">
                                    <small style="margin-bottom: 0">감독 : {{ movie.director }}</small>
                                    <br />
                                </div>
                            </div>
                        </div>
                    </a>
                    {% endfor %}
                </div>
            </div>
        </div>
    </section>
</section>
{% endblock %}

{% block script %}
<script>
    const passedGenre = '{{ genre.name }}';
    const genre = new Vue({
        el: '#genre',
        delimiters: ['[[', ']]'],
        data: {
            movies: [],
            selectedGenre: passedGenre,
            genreList: [],
            genres: [],
        },
        created() {
            axios.get("{% url 'movies:genres_list' %}")
                .then(res => {
                    this.genres = res.data;
                    res.data.forEach(genre => this.genreList.push({
                        id: genre.id,
                        name: genre.name
                    }));
                });
            let url = "{% url 'movies:genres_detail' genre.id %}";
            axios.get(url)
                .then(res => this.movies = res.data.movies);
            console.log(this.movies)
        },
        methods: {
            getGenreUrl: function (genreCard) {
                return "{% url 'movies:genres_index'%}"+`?name=${genreCard.name}`
            },
            getMovieList: function (genre) {
                this.selectedGenre = genre.name;
                history.replaceState({}, {}, `/movies/genres/?name=${this.selectedGenre}`);
            },
        }
    })
</script>
{% endblock %}